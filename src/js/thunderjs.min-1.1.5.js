if("undefined"==typeof jQuery)throw new Error("thunderJs requires jQuery");if("undefined"==typeof jQuery.ui)throw new Error("thunderJs requires jQuery.ui");!function(a,b){a.thunder||(a.thunder={}),a.thunder.version="1.1.5",a.thunder.statusCode={400:"Bad request",401:"Unauthorized",403:"Forbidden",404:"Page not found",405:"Method not allowed",407:"Proxy authentication required",408:"Request timeout",500:"Internal server error",501:"Not implemented",502:"Bad gateway",503:"Service unavailable"},a.thunder.activeModal=a({}),a.thunder.utility=function(){return{queryString:function(a){return this.querStringFormUrl(b.location.search,a)},querStringFormUrl:function(a,b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(a);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},statusCode:function(b){var c=a.extend(!0,{},{message:{plugin:"message",selector:null,showClose:!1}},b),d=function(b){var d=a.thunder.statusCode[b];"message"===c.message.plugin&&a(c.message.selector).length>0?a.thunder.message(c.message.selector,d,a.extend(!0,{type:"danger"},c.message)):a.thunder.alert(d,{type:"danger"})};return{400:function(){d(400)},401:function(){d(401)},403:function(){d(403)},404:function(){d(404)},405:function(){d(405)},407:function(){d(407)},408:function(){d(408)},500:function(){d(500)},501:function(){d(501)},502:function(){d(502)},503:function(){d(503)}}},guid:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}},a.thunder.closeModal=function(){"undefined"!==a.thunder.activeModal&&a.thunder.activeModal.length>0&&a.thunder.activeModal.dialog("close")},a.thunder.appendMessage=function(b,c){return a(b).each(function(){var b=function(b){var c=[];return a.isArray(b)&&b.length>0?void 0!==b[0].key&&void 0!==b[0].value?a.each(b,function(){a.isArray(this.value)?a.each(this.value,function(){c.push(this)}):c.push(this.value)}):a.each(b,function(){c.push(this)}):a.isPlainObject(b)&&void 0!==b.key&&void 0!==b.value?a.isArray(b.value)?a.each(b.value,function(){c.push(this)}):c.push(b.value):c.push(b),c},d=b(c);if(d.length>1){var e=a("<ul></ul>");a.each(d,function(){e.append(a("<li></li>").html(this))}),a(this).append(e)}else a(this).append(d[0])})},a.thunder.disableElement=function(b){return a(b).each(function(){a(this).addClass("disabled").attr("disabled","disabled")})},a.thunder.enableElement=function(b){return a(b).each(function(){a(this).removeClass("disabled").removeAttr("disabled")})},a.thunder.alert=function(c,d){var e=a.extend(!0,{onOk:function(){}},a.thunder.alert.defaultOptions,d),f=a("."+e.className),g=a('<div class="modal-dialog"></div>'),h=a('<div class="modal-content"></div>'),i=a('<div class="modal-header"></div>'),j=a('<div class="modal-body"></div>'),k=a('<div class="modal-footer"></div>'),l=a('<button type="button"></button>');0===f.length&&(f=a("<div></div>").addClass(e.className),a("body").append(f)),"none"!==e.type&&(f.removeClass(e.className+"-none").removeClass(e.className+"-success").removeClass(e.className+"-info").removeClass(e.className+"-warning").removeClass(e.className+"-danger"),f.addClass(e.className+"-"+e.type)),""!==a.trim(e.title)&&h.append(i.append(a('<h4 class="modal-title"></h4>').html(e.title))),l.addClass(e.button.className).html(e.button.label),l.on("click",function(){a.isFunction(e.onOk)&&e.onOk.call(f),f.modal("hide")}),a.thunder.appendMessage(j,c),h.append(j).append(k.append(l)),g.css("width",a(b).width()>e.width?e.width:a(b).width()-20).append(h),f.empty().addClass("modal").addClass(e.effect).append(g),f.on("shown.bs.modal",function(){l.focus()}),f.modal({keyboard:!1,backdrop:"static"})},a.thunder.alert.defaultOptions={title:"Alert",className:"thunder-alert",effect:"fade",type:"none",button:{label:"OK",className:"btn btn-default btn-sm"},width:600},a.thunder.confirm=function(c,d){var e=a.extend(!0,{onYes:function(){},onNo:function(){}},a.thunder.confirm.defaultOptions,d),f=a("."+e.className),g=a('<div class="modal-dialog"></div>'),h=a('<div class="modal-content"></div>'),i=a('<div class="modal-header"></div>'),j=a('<div class="modal-body"></div>').html(c),k=a('<div class="modal-footer"></div>'),l=a('<button type="button"></button>'),m=a('<button type="button"></button>');0===f.length&&(f=a("<div></div>").addClass(e.className),a("body").append(f)),""!==a.trim(e.title)&&h.append(i.append(a('<h4 class="modal-title"></h4>').html(e.title))),l.addClass(e.button.yes.className).html(e.button.yes.label).on("click",function(){a.isFunction(e.onYes)&&e.onYes.call(f),f.modal("hide")}),m.addClass(e.button.no.className).html(e.button.no.label).on("click",function(){a.isFunction(e.onNo)&&e.onNo.call(f),f.modal("hide")}),h.append(j).append(k.append(l).append(m)),g.css("width",a(b).width()>e.width?e.width:a(b).width()-20).append(h),f.empty().addClass("modal").addClass(e.effect).append(g),f.modal({keyboard:!1,backdrop:"static"})},a.thunder.confirm.defaultOptions={title:"Confirm",className:"thunder-confirm",effect:"fade",button:{yes:{label:"Yes",className:"btn btn-success btn-sm"},no:{label:"No",className:"btn btn-danger btn-sm"}},width:600},a.thunder.modal=function(c,d){var e=a.extend(!0,{data:{},open:function(){},beforeClose:function(){},close:function(){}},a.thunder.modal.defaultOptions,d);if("undefined"===c||""===a.trim(c))throw new Error("Unknown url");var f=function(){var b=function(){return c.indexOf("?")===-1?"?":"&"};return"get"===e.httpMethod&&(jQuery.isPlainObject(e.data)&&!jQuery.isEmptyObject(e.data)?c+=b()+a.param(e.data):"string"==typeof e.data&&(c+=b()+e.data)),e.forceReload&&(c+=b()+"forceReload="+parseInt(9999999999*Math.random(),10)),c+=b()+"forceFocusOnLoadInModal="+e.forceFocusOnLoadInModal},g=function(){for(var b=a("<div></div>").addClass("thunder-modal-loading"),c=1;c<=8;c++)b.append(a("<div></div>").addClass("thunder-modal-loading-item").addClass("thunder-modal-loading-item-"+c));return b},h=a.thunder.utility().guid(),i=a("."+e.className+"-iframe"),j=a("<iframe></iframe>").attr({frameborder:e.iframe.frameBorder,marginheight:e.iframe.marginHeight,marginwidth:e.iframe.marginWidth,scrolling:e.iframe.scrolling,name:h}).hide();"get"===e.httpMethod&&j.attr("src",f()),0===i.length&&(i=a("<div></div>").addClass(e.className+"-iframe"),a("body").append(i)),a.thunder.activeModal=i,i.empty().show().dialog({autoOpen:!0,modal:!0,resizable:!1,draggable:!1,closeOnEscape:e.closeOnEscape,dialogClass:e.className,width:a(b).width()>e.width?e.width:a(b).width()-20,height:e.height,open:function(){var c=g();if(i.prev(".ui-dialog-titlebar").remove(),j.attr("width",i.width()).attr("height",i.height()),i.append(c).append(j),"post"===e.httpMethod){var d=a("<form></form>").attr({action:f(),method:"post",target:h,id:a.thunder.utility().guid()}),k=[];a.isArray(e.data)?a.each(e.data,function(){a.each(this,function(a,b){k.push({name:a,value:b})})}):a.isPlainObject(e.data)&&!a.isEmptyObject(e.data)&&a.each(e.data,function(a,b){k.push({name:a,value:b})}),a.each(k,function(){d.append(a("<input />").attr({type:"hidden",name:this.name,value:this.value}))}),a("body").append(d),d.submit().remove()}j.load(function(){j.show(),c.remove(),b.setTimeout(function(){var b=j.contents();a.isFunction(e.open)&&e.open.call(b)},100)})},beforeClose:function(){i.empty(),a.isFunction(e.beforeClose)&&e.beforeClose.call()},close:function(){a.thunder.activeModal=a({}),i.remove(),a.isFunction(e.close)&&b.setTimeout(function(){e.close.call()},0)}})},a.thunder.modal.defaultOptions={className:"thunder-modal",httpMethod:"get",iframe:{frameBorder:0,marginHeight:0,marginWidth:0,scrolling:"auto"},width:600,height:400,forceReload:!0,forceFocusOnLoadInModal:!0,closeOnEscape:!1},a.thunder.openModal=function(b,c){return a(b).each(function(){var b=a(this),d=function(a){var b="about:blank";return a.is("a")&&"undefined"!==a.attr("href")&&"#"!==a.attr("href")&&""!==a.attr("href")&&(b=a.attr("href")),"about:blank"===b&&"undefined"!==a.data("url")&&(b=a.data("url")),b};return b.on("click",function(b){b.preventDefault(),a.thunder.modal(d(a(this)),a.extend(!0,{width:a(this).data("width"),height:a(this).data("height")},c))}),b})},a.thunder.message=function(c,d,e){var f=a.extend(!0,{show:function(){}},a.thunder.message.defaultOptions,e);return a(c).each(function(){var c=a(this).removeClass("alert").removeClass("alert-success").removeClass("alert-info").removeClass("alert-warning").removeClass("alert-danger").addClass("alert").addClass("alert-"+f.type).empty().hide().css(f.css),e=function(){f.removeAfterClose?c.remove():c.hide()};if(f.showClose){var g=a("<button></button>").attr("type","button").addClass("close").on("click",e).html("&times;");c.append(g)}return a.thunder.appendMessage(c,d),c.show(f.animate.duration,f.animate.easing,function(){a.isFunction(f.show)&&f.show.call(c)}),f.autoClose.enable&&b.setTimeout(e,f.autoClose.timer),c})},a.thunder.message.defaultOptions={showClose:!0,type:"success",removeAfterClose:!1,autoClose:{enable:!1,timer:5e3},css:{marginTop:0},animate:{duration:400,easing:"linear"}},a.thunder.ajaxForm=function(c,d){var e=a.extend(!0,{message:{selector:null},async:!0,autoResolveResult:!0,before:function(){},beforeSend:function(){},success:function(){},result:function(){},complete:function(){},validate:function(){return!0}},a.thunder.ajaxForm.defaultOptions,d);return a(c).each(function(){var c=a(this).addClass(e.className),d=a(e.message.selector),f=a(e.loading);if(c.is("form")&&("undefined"===c.attr("action")||""===a.trim(c.attr("action"))))throw new Error("Action attribute is empty in form");if(!c.is("form")&&("undefined"===c.data("action")||""===a.trim(c.data("action"))))throw new Error("Action attribute is empty in element");if(0!==d.length||c.prev().is("."+e.className+"-message")||(c.before(a("<div></div>").addClass(e.className+"-message")),d=c.prev()),0===f.length&&0===a("."+e.className+"-loading",c).length){f=a("<div></div>").addClass(e.className+"-loading");for(var g=1;g<=8;g++)f.append(a("<div></div>").addClass(e.className+"-loading-item").addClass(e.className+"-loading-item-"+g));c.prepend(f),f=a("."+e.className+"-loading",c)}var h=function(b,c){var f=a.extend({type:3},c),g=function(){return 0===f.type?"success":1===f.type?"info":2===f.type?"warning":3===f.type?"danger":""};"message"===e.message.plugin?a.thunder.message(d,b,a.extend(!0,{type:g(),show:function(){a.isFunction(e.message.show)&&e.message.show.call()}},e.message)):a.thunder.alert(b,{type:g()})},i=function(){var b=a("input,select,textarea",c);return"undefined"!==e.ignore&&""!==e.ignore&&(b=a("input,select,textarea",c).filter(e.ignore)),b},j=function(b){var c=i(),d=c.serializeArray();return a.isArray(b)?a.each(b,function(){a.each(this,function(a,b){d.push({name:a,value:b})})}):a.isPlainObject(b)&&!a.isEmptyObject(b)&&a.each(b,function(a,b){d.push({name:a,value:b})}),a.param(d)},k=function(g){var k=c,l={},m=i();g.preventDefault(),f.hide(),d.hide(),a.isFunction(e.before)&&(l=e.before.call(k));var n=j(l);if(!a.isFunction(e.validate)||e.validate.call(k,n)){var o=a.thunder.utility().statusCode(a.extend(!0,{message:{selector:d}},e.statusCode));a.ajax({statusCode:o,async:e.async,url:k.is("form")?k.attr("action"):k.data("action"),type:k.is("form")?k.attr("method"):k.data("method")||"post",data:n,headers:{"Url-Parent":b.location.pathname},beforeSend:function(){f.show(),a.thunder.disableElement(a("input,select,textarea,button",k)),m.removeClass(e.className+"-error"),m.closest(".form-group").removeClass("has-error"),a.isFunction(e.beforeSend)&&e.beforeSend.call(k,m)},complete:function(){a.thunder.enableElement(a("input,select,textarea,button",k)),f.hide(),a.isFunction(e.complete)&&e.complete.call(k)},success:function(c){b.setTimeout(function(){e.autoResolveResult&&a.isPlainObject(c)&&!a.isEmptyObject(c)&&"undefined"!==c.type?0===c.type?a.isFunction(e.success)&&e.success.call(k,c):(a.each(c.messages,function(){if(void 0!==this.key){var b=a("[name='"+this.key+"'],#"+this.key,k);b.closest(".form-group").length>0?b.closest(".form-group").addClass("has-error"):b.addClass(e.className+"-error")}}),h(c.messages,{type:c.type})):e.success.call(k,c),a.isFunction(e.result)&&e.result.call(k,c)},0)}})}},l=i();if(c.is("form"))c.on("submit",function(a){k(a)});else{var m=a(e.submitButton);l.each(function(){a(this).on("keypress",function(a){13===a.which&&(a.preventDefault(),m.trigger("click"))})}),m.on("click",function(a){k(a)})}return l.each(function(){a(this).on("blur",function(){(a(this).is("select")&&"0"!==a(this).val()||!a(this).is("select")&&""!==a(this).val())&&a(this).removeClass(e.className+"-error")})}),c})},a.thunder.ajaxForm.defaultOptions={className:"thunder-ajax-form",ignore:"",loading:null,submitButton:"button.submit-button, a.submit-button",statusCode:{message:{plugin:"message",showClose:!1}},message:{plugin:"message",showClose:!0}},a.thunder.grid=function(c,d){var e=a.extend(!0,{message:{selector:null},fieldPrefix:"",async:!0,load:!0,currentPage:0,form:null,before:function(){},success:function(){},complete:function(){},validate:function(){return!0}},a.thunder.grid.defaultOptions,d),f=function(b,c){var d=a.extend({type:3},c),f=function(){return 0===d.type?"success":1===d.type?"info":2===d.type?"warning":3===d.type?"danger":""};"message"===e.message.plugin?a.thunder.message(this,b,a.extend(!0,{type:f(),show:function(){a.isFunction(e.message.show)&&e.message.show.call()}},e.message)):a.thunder.alert(b,{type:f()})},g=function(b){var c=a(this),d=a("input,select,textarea",c);"undefined"!==e.ignore&&""!==e.ignore&&(d=a("input,select,textarea",c).filter(e.ignore));var f=d.serializeArray();return a.isArray(b)?a.each(b,function(){a.each(this,function(a,b){f.push({name:a,value:b})})}):a.isPlainObject(b)&&!a.isEmptyObject(b)&&a.each(b,function(a,b){f.push({name:a,value:b})}),a.param(f)},h=function(a){return null!==e.fieldPrefix&&""!==e.fieldPrefix?e.fieldPrefix+"."+a:a},i=function(b){a("."+e.className+"-current-page",this).val(b)},j=function(){var c=a(this),d=c.data("form"),h=c.data("loading"),i=c.data("message"),j=c.data("content"),k={};h.hide(),i.hide(),a.isFunction(e.before)&&(k=e.before.call(d));var l=g.call(d,k);if(!a.isFunction(e.validate)||e.validate.call(d,l)){var m=a.thunder.utility().statusCode(a.extend(!0,{message:{selector:i}},e.statusCode));a.ajax({statusCode:m,async:e.async,url:d.attr("action"),type:d.attr("method"),data:l,headers:{"Url-Parent":b.location.pathname},beforeSend:function(){h.show(),a.thunder.disableElement(a("input,select,textarea,button",d)),a.thunder.disableElement(a("a,input,select,textarea,button",c)),a("input,select,textarea",d).removeClass(e.className+"-error")},complete:function(){a.thunder.enableElement(a("input,select,textarea,button",d)),a.thunder.enableElement(a("a,input,select,textarea,button",c)),h.hide(),a.isFunction(e.complete)&&e.complete.call(d)},success:function(c){b.setTimeout(function(){if(a.isPlainObject(c)&&!a.isEmptyObject(c)&&"undefined"!==c.type)if(0===c.type)a.isFunction(e.success)&&e.success.call(d,c);else{var b=null;a.each(c.messages,function(){if(void 0!==this.key){var c=a("[name='"+this.key+"'],#"+this.key,d);null===b&&(b=c),c.addClass(e.className+"-error")}}),f(c.messages,{type:c.type})}else j.html(c),e.success.call(d,c)},0)}})}};return"reload"===d?(a(c).trigger("reload"),a(c)):a(c).each(function(){var b=a(this),c=a(e.message.selector),d=a(e.loading),f=a(e.form),g=a("<div></div>");if(b.addClass(e.className).css(e.css),0===a("."+e.className+"-content",b).length?g.addClass(e.className+"-content").css(e.content.css):g=a("."+e.className+"-content",b),void 0===b.data("url"))throw new Error("Data url attribute is empty in grid");if(0!==c.length||b.prev().is("."+e.className+"-message")||(b.before(a("<div></div>").addClass(e.className+"-message")),c=b.prev()),0===f.length&&0===a("."+e.className+"-form",b).length&&(b.prepend(a(e.useForm?"<form></form>":"<div></div>").addClass(e.className+"-form")),f=a("."+e.className+"-form",b)),0===d.length&&0===a("."+e.className+"-loading",b).length){d=a("<div></div>").addClass(e.className+"-loading");for(var k=1;k<=8;k++)d.append(a("<div></div>").addClass(e.className+"-loading-item").addClass(e.className+"-loading-item-"+k));b.prepend(d),d=a("."+e.className+"-loading",b)}return 0===a("."+e.className+"-current-page",f).length&&f.prepend(a("<input/>").attr("type","hidden").attr("name",h("CurrentPage")).val(e.currentPage).addClass(e.className+"-current-page")),0===a("."+e.className+"-page-size",f).length&&f.prepend(a("<input/>").attr("type","hidden").attr("name",h("PageSize")).val(e.pageSize).addClass(e.className+"-page-size")),0===a("."+e.className+"-content",b).length&&b.append(g),f.attr("action",b.data("url")).attr("method",e.httpMethod).on(e.useForm?"submit":"send",function(a){a.preventDefault(),i.call(this,0),j.call(b)}),b.data("loading",d).data("message",c).data("content",g).data("form",f),b.bind("reload",function(){f.trigger(e.useForm?"submit":"send")}),e.useForm||(a("input:text",f).on("keypress",function(a){13===a.which&&f.trigger("send")}),a(e.buttonSubmit,f).on("click",function(a){a.preventDefault(),f.trigger("send")})),b.on("click","ul.pagination a",function(c){var d=a(this);c.preventDefault(),d.is(".disabled")||d.parents("li:first").is(".disabled")||(i.call(f,d.data("page")),j.call(b))}),e.load&&j.call(b),b})},a.thunder.grid.defaultOptions={className:"thunder-grid",ignore:"",loading:null,httpMethod:"POST",useForm:!0,buttonSubmit:null,statusCode:{message:{plugin:"message",showClose:!1}},message:{plugin:"message",showClose:!0},pageSize:20,css:{},content:{css:{}}},a.thunder.openModal("[data-thunder-plugin=modal]"),a("[data-window=modal]").length>0&&("true"===a.thunder.utility().queryString("forceFocusOnLoadInModal")&&b.setTimeout(function(){a("input:visible:not(input[type='hidden'],:disabled),select:visible:not(:disabled),textarea:visible:not(:disabled)").filter(":first").focus()},500),a("button.close").on("click",function(){b.parent.$.thunder.closeModal()}))}(window.jQuery,window);